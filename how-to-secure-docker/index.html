<!DOCTYPE html><html lang="en-gb"><head><link rel="stylesheet" href="https://baronhez.github.io/assets/css/prism.css?v=2b0833fe69a354f994abc0868f9566cb"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>How to secure Docker - blogHez</title><meta name="description" content="Some tips&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://baronhez.github.io/how-to-secure-docker/"><link rel="alternate" type="application/atom+xml" href="https://baronhez.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://baronhez.github.io/feed.json"><meta property="og:title" content="How to secure Docker"><meta property="og:image" content="https://baronhez.github.io/media/posts/18/dockerSec.jpeg"><meta property="og:site_name" content="blogHez"><meta property="og:description" content="Some tips&hellip;"><meta property="og:url" content="https://baronhez.github.io/how-to-secure-docker/"><meta property="og:type" content="article"><link rel="stylesheet" href="https://baronhez.github.io/assets/css/style.css?v=e593e396d418be8ac87b451f827877c0"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://baronhez.github.io/how-to-secure-docker/"},"headline":"How to secure Docker","datePublished":"2022-09-03T22:28","dateModified":"2022-09-03T22:33","image":{"@type":"ImageObject","url":"https://baronhez.github.io/media/posts/18/dockerSec.jpeg","height":753,"width":640},"description":"Some tips&hellip;","author":{"@type":"Person","name":"Jonathan Ródenas López","url":"https://baronhez.github.io/jonathan/jonathan-rodenas-lopez/"},"publisher":{"@type":"Organization","name":"Jonathan Ródenas López"}}</script></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://baronhez.github.io/">blogHez</a></header><main><article class="post"><div class="hero"><figure class="hero__image hero__image--overlay"><img src="https://baronhez.github.io/media/posts/18/dockerSec.jpeg" srcset="https://baronhez.github.io/media/posts/18/responsive/dockerSec-xs.jpeg 300w, https://baronhez.github.io/media/posts/18/responsive/dockerSec-sm.jpeg 480w, https://baronhez.github.io/media/posts/18/responsive/dockerSec-md.jpeg 768w, https://baronhez.github.io/media/posts/18/responsive/dockerSec-lg.jpeg 1024w, https://baronhez.github.io/media/posts/18/responsive/dockerSec-xl.jpeg 1360w, https://baronhez.github.io/media/posts/18/responsive/dockerSec-2xl.jpeg 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="753" width="640" alt=""></figure><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2022-09-03T22:28">September 3, 2022</time></div><h1>How to secure Docker</h1><div class="post__meta post__meta--author"><a href="https://baronhez.github.io/jonathan/jonathan-rodenas-lopez/" class="feed__author">Jonathan Ródenas López</a></div></div></header></div><div class="wrapper post__entry"><h2 id="some-tips-to-have-a-more-secure-experience-while-using-docker">Some tips to have a more secure experience while using Docker</h2><p>Ok, the other day I was browsing my bookmarks when I came across an interesting post about Docker security. Because of this, I'm going to share some tips for you to secure your Docker. This way, you will feel safer while using Docker to run some dangerous software, preventing access to your host machine.</p><h2 id="tip-1-do-not-havenbspoutdated-containers-running-in-your-server">Tip #1: Do NOT have&nbsp;outdated containers running in your server.</h2><p>This applies too to Docker itself. Using software outdated, even when we use containers, is insecure, and can lead to vulnerabilities. Containers talk directly to the kernel, so a kernel related vulnerability which can allow the user to modify the kernel, can lead us to a disaster.</p><h2 id="tip-2nbsp-do-not-expose-the-docker-daemon-socket">Tip #2:&nbsp; Do NOT expose the Docker daemon socket.</h2><p>"But, if my containers need to comunicate with other containers..." Well, do it at your own risk, buddy. I do not encourage anyone to do this. You can do it, but following good security practices, as seen in the <a href="https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-socket-option" target="_blank" rel="nofollow noopener">Docker Documentation</a>.</p><h2 id="tip-3-do-not-run-your-containers-as-root-user">Tip #3: Do NOT run your containers as root user.</h2><p>Use an unprivileged user, during runtime:</p><pre class="line-numbers language-bash"><code>docker run -u 4000 alpine
</code></pre><p>Or during build time:</p><pre class="line-numbers language-docker"><code>FROM alpine
RUN groupadd -r myuser && useradd -r -g myuser myuser
&lt;HERE DO WHAT YOU HAVE TO DO AS A ROOT USER LIKE INSTALLING PACKAGES ETC.&gt;
USER myuser
</code></pre><p>You should also <a href="https://docs.docker.com/engine/security/userns-remap/#enable-userns-remap-on-the-daemon" target="_blank" rel="nofollow noopener">enable namespace support</a>.</p><h2 id="tip-4-do-not-run-containers-with-all-capabilities">Tip #4: Do NOT run containers with all capabilities.</h2><p>For those who don't know what <a href="https://man7.org/linux/man-pages/man7/capabilities.7.html" target="_blank" rel="nofollow noopener">capabilities</a>&nbsp;are, they are a set of privileges.&nbsp;Docker, by default, runs with only a subset of capabilities. But, you can drop some capabilities (using <b>--cap-drop</b>) to harden your docker containers, or add some capabilities (using <b>--cap-add</b>) if needed. Remember not to run containers with the <b>--privileged flag</b>&nbsp;(this will add ALL Linux kernel capabilities to the container).<br><br>The most secure setup is to drop all capabilities<b> --cap-drop</b> all and then add only required ones:</p><pre class="line-numbers language-bash"><code>docker run --cap-drop all --cap-add CHOWN alpine</code></pre><h2 id="tip-5-do-not-let-any-container-to-escalate-privileges">Tip #5: Do NOT let any container to escalate privileges.</h2><p>Always run your docker images with <b>--security-opt=no-new-privileges</b> in order to prevent escalate privileges using setuid or setgid binaries:</p><pre class="line-numbers language-bash"><code>docker run --security-opt=no-new-privileges alpine</code></pre><h2 id="tip-6-do-not-allow-your-containers-to-communicate-between-them">Tip #6: Do NOT allow your containers to communicate between them.</h2><p>By default inter-container communication (<b>icc</b>) is enabled - it means that all containers can talk with each other (using docker0 bridged network). This can be disabled by running docker daemon with --icc=false flag.</p><p>If icc is disabled (icc=false) it is required to tell which containers can communicate using <b>--link=CONTAINER_NAME&nbsp;</b>or <b>ID:ALIAS </b>option:</p><pre class="line-numbers language-bash"><code>docker run --link=web alpine</code></pre><h2 id="tip-7-do-not-forget-about-using-a-good-security-module">Tip #7: Do NOT forget about using a good security module.</h2><p>I have seen information about&nbsp;<a href="https://docs.docker.com/engine/security/seccomp/" target="_blank" rel="nofollow noopener">seccomp </a>or <a href="https://docs.docker.com/engine/security/apparmor/" target="_blank" rel="nofollow noopener">AppArmor</a>. This will help you to protect yourself againts vulnerability.</p><h2 id="tip-8-do-not-allow-your-containers-to-use-as-much-cpu-and-memory-as-they-can-set-limits">Tip #8: Do NOT allow your containers to use as much CPU and memory as they can. Set limits.</h2><p>You can limit memory, CPU, maximum number of restarts (--restart=on-failure:&lt;number of restarts&gt;<number_of_restarts>), maximum number of file descriptors (--ulimit nofile=&lt;number&gt;<number>) and maximum number of processes (--ulimit nproc=&lt;number&gt;<number>).</number></number></number_of_restarts></p><p>Refer to the <a href="https://docs.docker.com/engine/reference/commandline/run/#set-ulimits-in-container---ulimit" target="_blank" rel="nofollow noopener">documentation</a> for more information about ulimits, or to this <a href="https://docs.docker.com/config/containers/resource_constraints/" target="_blank" rel="nofollow noopener">documentation </a>about memory and cpu limits during runtime.</p><h2 id="tip-9-do-not-allow-your-containers-to-write-to-your-file-system-if-possible">Tip #9: Do NOT allow your containers to write to your file system if possible.</h2><p>If you can, use read-only&nbsp;using <b>--read-only</b> flag. For instance:</p><pre class="line-numbers language-bash"><code>docker run --read-only alpine sh -c 'echo "whatever" &gt; /tmp'</code></pre><p>If an application inside a container has to save something temporarily, combine <b>--read-only</b> flag with<b> --tmpfs</b> like this:</p><pre class="line-numbers language-bash"><code>docker run --read-only --tmpfs /tmp alpine sh -c 'echo "whatever" &gt; /tmp/file'
</code></pre><p>In Docker-Compose would be something like:</p><pre class="line-numbers language-yaml"><code>version: "3"
services:
  alpine:
    image: alpine
    read_only: true
</code></pre><p>It is possible to do it with volumes:</p><pre class="line-numbers language-yaml"><code>web:
    container_name: web
    image: nginx
    volumes:
      - /home/user/nginx/html:/usr/share/nginx/html:ro
</code></pre><p>This option is also available in runtime:</p><pre class="line-numbers language-bash"><code>docker run -v volume-name:/path/in/container:ro alpine</code></pre><p>You can do this using the<b> --mount</b> option:</p><pre class="line-numbers language-bash"><code>docker run --mount source=volume-name,destination=/path/in/container,readonly alpine</code></pre><h2 id="tip-10-do-not-forget-aboutnbspstatic-analysis-tools">Tip #10: Do NOT forget about&nbsp;static analysis tools.</h2><p>There are a few useful tools that can help you in various ways.&nbsp;This list is from that article I previously mentioned above:</p><h4 id="to-scan-your-containers-in-search-of-vulnerabilitiesnbsp">To scan your containers in search of vulnerabilities:&nbsp;</h4><h5 id="free">Free</h5><ul><li><a href="https://github.com/coreos/clair" target="_blank" rel="nofollow noopener">Clair</a></li><li><a href="https://github.com/deepfence/ThreatMapper" target="_blank" rel="nofollow noopener">ThreatMapper</a><br></li><li><a href="https://github.com/knqyf263/trivy" target="_blank" rel="nofollow noopener">Trivy</a></li></ul><h5 id="commercial">Commercial</h5><ul><li><a href="https://snyk.io/" target="_blank" rel="nofollow noopener">Snyk</a>&nbsp;<b>(open source and free option available)</b></li><li><a href="https://anchore.com/opensource/" target="_blank" rel="nofollow noopener">anchore</a>&nbsp;<b>(open source and free option available)</b><br></li><li><a href="https://jfrog.com/xray/" target="_blank" rel="nofollow noopener">JFrog XRay</a><br></li><li><a href="https://www.qualys.com/apps/container-security/" target="_blank" rel="nofollow noopener">Qualys</a><br></li></ul><h4 id="to-detect-secrets-in-images">To detect secrets in images:</h4><ul><li><a href="https://github.com/GitGuardian/ggshield" target="_blank" rel="nofollow noopener">ggshield</a>&nbsp;<b>(open source and free option available)</b></li><li><a href="https://github.com/deepfence/SecretScanner" target="_blank" rel="nofollow noopener">SecretScanner&nbsp;</a>&nbsp;<b>(open source)</b></li></ul><h4 id="to-detect-misconfigurations-in-docker">To detect misconfigurations in Docker:</h4><ul><li><a href="https://www.inspec.io/docs/reference/resources/docker/" target="_blank" rel="nofollow noopener">inspec.io</a></li><li><a href="https://dev-sec.io/baselines/docker/" target="_blank" rel="nofollow noopener">dev-sec.io</a><br></li><li><a href="https://github.com/docker/docker-bench-security" target="_blank" rel="nofollow noopener">Docker Bench for Security</a></li></ul><h2 id="tip-11-do-not-forget-about-logs">Tip #11: Do NOT forget about logs.</h2><p>Set up an appropriate log level, you'll thank me later. Countless time I've been safe by logs. You should configure the Docker daemon to log events that you would want to review later:</p><pre class="line-numbers language-bash"><code>docker-compose --log-level info up  </code></pre><h2 id="tip-12-do-not-forget-about-linting-your-dockerfiles-during-build-time">Tip #12: Do NOT forget about linting your Dockerfiles during build time.</h2><p>It is as easy as following a few good practices:</p><ul><li>Ensure a <b>USER </b>directive is specified.</li><li>Ensure the base image version is pinned.<br></li><li>Ensure the OS packages versions are pinned.<br></li><li>Avoid the use of <b>ADD </b>in favor of <b>COPY</b>.<br></li><li>Avoid curl bashing in <b>RUN </b>directives.</li></ul><p>Aaaaaand that's it, folks. Following this tips, you should be safer while using Docker. Have a nice day, friend.</p><h2 id="credits">Credits</h2><p><a href="https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html" target="_blank" rel="nofollow noopener">https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html</a></p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on September 3, 2022</p><ul class="post__tag"><li><a href="https://baronhez.github.io/blog/docker/">Docker</a></li><li><a href="https://baronhez.github.io/blog/docker-compose/">Docker-compose</a></li><li><a href="https://baronhez.github.io/blog/security/">Security</a></li></ul><div class="post__share"></div><div class="post__bio bio"><div class="bio__info"><h3 class="bio__name"><a href="https://baronhez.github.io/jonathan/jonathan-rodenas-lopez/" rel="author">Jonathan Ródenas López</a></h3></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://baronhez.github.io/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://baronhez.github.io/how-to-convert-different-files-online/" class="post__nav-link" rel="prev"><span>Previous</span> How to convert different files online</a></div><div class="post__nav-next"><a href="https://baronhez.github.io/how-to-create-yaml-files/" class="post__nav-link" rel="next"><span>Next</span> How to create YAML files </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://baronhez.github.io/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav><div class="post__related related"><div class="wrapper"><h2 class="h5 related__title">You should also read:</h2><article class="related__item"><div class="feed__meta"><time datetime="2022-08-31T04:20" class="feed__date">August 31, 2022</time></div><h3 class="h1"><a href="https://baronhez.github.io/how-to-clean-your-docker/">How to clean your Docker.</a></h3></article><article class="related__item"><div class="feed__meta"><time datetime="2022-08-31T04:10" class="feed__date">August 31, 2022</time></div><h3 class="h1"><a href="https://baronhez.github.io/different-uses-for-docker/">Different uses for Docker</a></h3></article><article class="related__item"><div class="feed__meta"><time datetime="2022-08-31T03:23" class="feed__date">August 31, 2022</time></div><h3 class="h1"><a href="https://baronhez.github.io/docker-compose-best-practices/">Docker-Compose Best Practices</a></h3></article></div></div></main><footer class="footer"><script defer="defer" src="https://baronhez.github.io/assets/js/prism.js?v=f745a05992777ae78ef04e93948dd9d2"></script><div class="footer__social"><a href="https://twitter.com/Baronhez1" aria-label="Twitter"><svg><use xlink:href="https://baronhez.github.io/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://www.linkedin.com/in/jonathanrodenaslopez/" aria-label="LinkedIn"><svg><use xlink:href="https://baronhez.github.io/assets/svg/svg-map.svg#linkedin"/></svg></a></div><div class="footer__copyright"><p>This is the personal blog of Jonathan Ródenas López.</p></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg><use xlink:href="https://baronhez.github.io/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script defer="defer" src="https://baronhez.github.io/assets/js/scripts.min.js?v=f47c11534595205f20935f0db2a62a85"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>